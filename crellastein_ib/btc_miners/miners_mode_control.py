#!/usr/bin/env python3
"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    BTC MINERS MODE CONTROL
                    CIFR | CLSK | IREN - Options DCA Strategy
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Mode 1: BULLISH DCA
  - Always have exposure (freeroll position)
  - DCA by selling more options as premium drops
  - Let winners run

Mode 2: CORRECTION
  - Hedge with protective puts
  - Smaller position sizing
  - Wider DCA spacing

Mode 3: BEARISH
  - Close longs, no new sells
  - Wait for setup

Commands:
    python miners_mode_control.py 1        # Bullish DCA
    python miners_mode_control.py 2        # Correction
    python miners_mode_control.py 3        # Bearish
    python miners_mode_control.py status   # Show status

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

import json
import sys
from pathlib import Path
from datetime import datetime

STATE_FILE = Path(__file__).parent / 'miners_state.json'
SETUP_FILE = Path(__file__).parent / 'MODE1_DCA_SETUP.json'


def load_state():
    if STATE_FILE.exists():
        with open(STATE_FILE, 'r') as f:
            return json.load(f)
    return {
        'mode': 1,
        'mode_name': 'BULLISH_DCA',
        'dca_enabled': True,
        'hedge_enabled': False,
        'symbols': ['CIFR', 'CLSK', 'IREN'],
    }


def save_state(state):
    state['last_update'] = datetime.now().isoformat()
    with open(STATE_FILE, 'w') as f:
        json.dump(state, f, indent=2)


def mode_1_bullish():
    """Mode 1: Bullish DCA - Scale in on dips"""
    state = load_state()
    state.update({
        'mode': 1,
        'mode_name': 'BULLISH_DCA',
        'dca_enabled': True,
        'hedge_enabled': False,
        'new_sells_enabled': True,
        'close_longs': False,
    })
    save_state(state)
    
    print("""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            ğŸ“ˆ MODE 1: BULLISH DCA - BTC MINERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Symbols: CIFR | CLSK | IREN

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ¯ REQUIRED: Always have exposure (freeroll)                          â”‚
  â”‚  Strategy: Sell options, DCA as premium drops                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âœ… DCA Selling:     ACTIVE (scale in on premium drops)
  âœ… New Positions:   ACTIVE (sell puts/calls on dips)
  âŒ Hedge:           OFF (full bullish)
  âœ… Let Winners Run: Yes

  DCA Rules:
    â€¢ Premium drops 20% â†’ Add HALF position
    â€¢ Premium drops 40% â†’ Add FULL position
    â€¢ Premium drops 60% â†’ Add DOUBLE position

  "Stay long, DCA dips, let winners run"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
""")


def mode_2_correction():
    """Mode 2: Correction - Hedge and reduce"""
    state = load_state()
    state.update({
        'mode': 2,
        'mode_name': 'CORRECTION',
        'dca_enabled': True,
        'hedge_enabled': True,
        'new_sells_enabled': True,
        'close_longs': False,
    })
    save_state(state)
    
    print("""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            ğŸ“Š MODE 2: CORRECTION - BTC MINERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Symbols: CIFR | CLSK | IREN

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ¯ REQUIRED: Hedge with protective puts                               â”‚
  â”‚  Strategy: Smaller sizing, wider DCA spacing                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âœ… DCA Selling:     ACTIVE (but smaller size)
  âœ… New Positions:   ACTIVE (cautious)
  âœ… Hedge:           ACTIVE (buy protective puts)
  âš ï¸ Sizing:          HALF normal size

  "Protected but still participating"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
""")


def mode_3_bearish():
    """Mode 3: Bearish - Close and wait"""
    state = load_state()
    state.update({
        'mode': 3,
        'mode_name': 'BEARISH',
        'dca_enabled': False,
        'hedge_enabled': True,
        'new_sells_enabled': False,
        'close_longs': True,
    })
    save_state(state)
    
    print("""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            ğŸ» MODE 3: BEARISH - BTC MINERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Symbols: CIFR | CLSK | IREN

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  âš ï¸ ACTION: Close longs, no new option sells                           â”‚
  â”‚  Strategy: Wait for setup, preserve capital                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âŒ DCA Selling:     STOPPED
  âŒ New Positions:   STOPPED  
  âš ï¸ Close Longs:     YES (or tight stops)
  âœ… Cash Ready:      For next opportunity

  "Preserve capital, wait for reversal"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
""")


def show_status():
    """Show current status"""
    state = load_state()
    
    # Load setup if exists
    setup = {}
    if SETUP_FILE.exists():
        with open(SETUP_FILE, 'r') as f:
            setup = json.load(f)
    
    mode_emoji = {1: 'ğŸ“ˆ', 2: 'ğŸ“Š', 3: 'ğŸ»'}
    
    print(f"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    BTC MINERS STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Current Mode: {mode_emoji.get(state['mode'], 'â“')} {state['mode_name']} (Mode {state['mode']})

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ DCA Enabled:      {'âœ… ACTIVE' if state.get('dca_enabled') else 'âŒ OFF':20} â”‚
  â”‚ Hedge Enabled:    {'âœ… ACTIVE' if state.get('hedge_enabled') else 'âŒ OFF':20} â”‚
  â”‚ New Sells:        {'âœ… ACTIVE' if state.get('new_sells_enabled') else 'âŒ OFF':20} â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
""")
    
    if setup.get('symbols'):
        print("  ğŸ“Š POSITIONS:")
        for sym, data in setup['symbols'].items():
            print(f"    {sym}: {data.get('current_position', 0)} @ ${data.get('current_price', 0):.2f} | P&L: ${data.get('unrealized_pnl', 0):+,.0f}")
    
    if setup.get('total_account'):
        acc = setup['total_account']
        print(f"""
  ğŸ’° ACCOUNT:
    Balance:    ${acc.get('balance', 0):,.0f}
    Total P&L:  ${acc.get('total_pnl', 0):+,.0f}
    Realized:   ${acc.get('realized', 0):+,.0f}
    Unrealized: ${acc.get('unrealized', 0):+,.0f}
""")
    
    print("""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  COMMANDS:
    python miners_mode_control.py 1        # Bullish DCA
    python miners_mode_control.py 2        # Correction
    python miners_mode_control.py 3        # Bearish

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
""")


def main():
    if len(sys.argv) < 2:
        show_status()
        return
    
    cmd = sys.argv[1].lower()
    
    if cmd == '1' or cmd == 'bullish':
        mode_1_bullish()
    elif cmd == '2' or cmd == 'correction':
        mode_2_correction()
    elif cmd == '3' or cmd == 'bearish':
        mode_3_bearish()
    elif cmd == 'status':
        show_status()
    else:
        print(f"Unknown command: {cmd}")
        print("Use: 1, 2, 3, or status")


if __name__ == "__main__":
    main()
